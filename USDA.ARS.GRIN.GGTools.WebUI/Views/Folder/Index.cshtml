@model USDA.ARS.GRIN.GGTools.ViewModelLayer.FolderViewModel
@{
    ViewBag.Title = Model.PageTitle;
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}
<div id="overlay"></div>
<div class="card card-primary card-tabs">
    <div id="DEBUG-TABS" class="card-header p-0 pt-1">
        <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
            <li class="pt-2 px-3"><h3 class="card-title">My Folders</h3></li>

            @{
                int i = 0;
                string tabSelectorCssClass = String.Empty;
            }
            @foreach (var result in Model.DataCollection)
            {
                if (i == 0)
                {
                    tabSelectorCssClass = "nav-link active";
                }
                else
                {
                    tabSelectorCssClass = "nav-link";
                }

                <li 
                    id="custom-tabs-two-home-tab-selector-@result.ID" 
                    title="@result.FolderTypeDescription.Replace(" ","")" 
                    class="nav-item">
                    <a class="@tabSelectorCssClass"  data-toggle="pill" href="#custom-tabs-two-home-@result.ID" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true">
                        @if (result.IsShared == "Y")
                        {
                            <i class="fa fa-users"></i>
                        }
                        @result.FolderName
                    </a>
                </li>
                i++;
            }
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="custom-tabs-two-tabContent">
            @{
                int j = 0;
                string tabContentCssClass = String.Empty;
            }

            @foreach (var result in Model.DataCollection)
            {
                if (j == 0)
                {
                    tabContentCssClass = "tab-pane fade show active";
                }
                else
                {
                    tabContentCssClass = "tab-pane fade show";
                }
                <div class="@tabContentCssClass" id="custom-tabs-two-home-@result.ID" role="tabpanel" aria-labelledby="custom-tabs-two-home-tab">

                    @*<h4>@result.FolderName</h4>
                        <h4>@result.FolderType</h4>
                        <h4>@result.FolderTypeDescription</h4>
                        <h4>@result.CreatedByCooperatorName</h4>
                        <h4>@result.Category</h4>*@

                    @if (result.FolderTypeDescription == "NONE")
                    {
                        @Html.Partial("~/Views/Error/_InternalServerError.cshtml")
                    }
                    else
                    {
                        { Html.RenderAction("_ListFolderItems", result.FolderTypeDescription.Replace(" ", ""), new { @folderId = result.ID, displayFormat = "" }); }
                    }
                </div>
                j++;
            }
        </div>
    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        Init();
    });

    function Init() {
        //var tabName = $("#DEBUG-TABS ul.nav li:first").attr('id');
        ////DEBUG
        //alert("FIRST TAB IS " + tabName);
        /*InitDataTablesByClass(".folder-table");*/
    }

    function InitDataTablesByClass(className) {
        $(document).ready(function () {
            var table = $(className).DataTable({
                dom: 'Blfrtip',
                paging: true,
                "pageLength": 10,
                initComplete: function () {
                    SetControlVisibility(tableName);
                },
                responsive: true,
                buttons: [
                    'selectAll',
                    'selectNone',
                    'csv',
                    'excel',
                    'pdf',
                    {
                        text: '+ Add',
                        action: function (e, dt, node, config) {
                            AddRecord();
                        }
                    }
                ],
                select: true,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                columnDefs: [
                    { targets: [0], visible: false }
                ]
            });

            //var table = $(tableName).DataTable(); // Valid initialized DataTable
            //if (table instanceof $.fn.dataTable.Api) {
            //    //DEBUG
            //    alert(tableName + " IS DTABLE");
            //} else {

            //}


            //if (!$.fn.DataTable.isDataTable(tableName)) {
            //    var table = $(tableName).DataTable({
            //        dom: 'Blfrtip',
            //        paging: true,
            //        "pageLength": 10,
            //        initComplete: function () {
            //            SetControlVisibility(tableName);
            //        },
            //        responsive: true,
            //        buttons: [
            //            'selectAll',
            //            'selectNone',
            //            'csv',
            //            'excel',
            //            'pdf'
            //        ],
            //        select: true,
            //        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            //        columnDefs: [
            //            { targets: [0], visible: false }
            //        ]
            //    });
            //}
            //else {

            //}
        });
    }

    $('#DEBUG-TABS ul.nav li').on('click', function () {
        var tabName = $(this).attr('id');
        var title = $(this).attr('title');
        //DEBUG
        alert("DEBUG " + tabName + " AND " + title);
    });

    function ListFolderItems(folderTypeDescription, folderId)  {
        var link = '@Url.Action("FolderItems", "CONTROLLER_NAME")';
        link = link.replace("CONTROLLER_NAME", folderTypeDescription);

        var formData = new FormData();
        formData.append("FolderID", folderId);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-folder-items").html(response);
            },
            error: function (jqXHR) {
                alert("Error loading folder contents");
            }
        });
    }

</script>
