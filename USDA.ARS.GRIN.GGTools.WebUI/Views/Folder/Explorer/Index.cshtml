@model USDA.ARS.GRIN.GGTools.ViewModelLayer.FolderViewModel
@{
    ViewBag.Title = Model.PageTitle;
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}
<div id="overlay"></div>
<h5 class="mt-4 mb-2"><i class="fas fa-folder"></i> My Folders</h5>
<div class="row">
    <div class="col-md-3">

        <!-- BEGIN CATEGORY LIST -->
        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-filter"></i> Category</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div id="section-folder-category" class="card-body p-0">
                <ul class="nav nav-pills flex-column">
                    <li id="favorites" class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="fas fa-star text-warning"></i> Favorites
                        </a>
                    </li>
                    <li id="default-all" class="nav-item">
                        <a href="#" class="nav-link">
                            All
                        </a>
                    </li>

                    @foreach (var result in Model.DataCollectionFolderCategories)
                    {
                        <li id="@result.Value" class="nav-item">
                            <a href="#" class="nav-link">
                                @result.Title
                            </a>
                        </li>
                    }
                </ul>
            </div>

        </div>
        <!-- END CATEGORY LIST -->
        <!-- BEGIN FOLDER TYPE LIST -->
        <div class="card  card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-filter"></i> Type</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div id="section-folder-type" class="card-body p-0">
                <ul class="nav nav-pills flex-column">
                    <li id="default-all" class="nav-item active">
                        <a href="#" class="nav-link">
                            All
                        </a>
                    </li>

                    @foreach (var result in Model.DataCollectionFolderTypes)
                    {
                        <li id="@result.Value" class="nav-item">
                            <a href="#" class="nav-link">
                                @result.Title
                            </a>
                        </li>
                    }
                </ul>
            </div>

        </div>
        <!-- END FOLDER TYPE LIST -->

    </div>
    <div id="section-folder-list" class="col-md-9">
        @{Html.RenderAction("_ListExplorer", "Folder");}
    </div>
</div>

@{Html.RenderAction("RenderReportsWidget","Species"); }

<script type="text/javascript">

    $(document).ready(function () {
        Init();
    });

    function Init() {
        // Note that we must load the *second* sequential <li> in the tabbed folder list: first
        // is a static display item.
        var tabName = $("#DEBUG-TABS ul.nav li:nth-child(2)").attr('id');
        var title = $("#DEBUG-TABS ul.nav li:nth-child(2)").attr('title');
        var folderId = tabName.replace("custom-tabs-two-home-tab-selector-", "");
        LoadFolderItems(title, folderId);
    }

    function InitDataTablesByClass(className) {
        $(document).ready(function () {
            var table = $(className).DataTable({
                dom: 'Blfrtip',
                paging: true,
                "pageLength": 10,
                initComplete: function () {
                    SetControlVisibility(tableName);
                },
                responsive: true,
                buttons: [
                    'selectAll',
                    'selectNone',
                    'csv',
                    'excel',
                    'pdf',
                    {
                        text: '+ Add',
                        action: function (e, dt, node, config) {
                            AddRecord();
                        }
                    }
                ],
                select: true,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                columnDefs: [
                    { targets: [0], visible: false }
                ]
            });

            //var table = $(tableName).DataTable(); // Valid initialized DataTable
            //if (table instanceof $.fn.dataTable.Api) {
            //    //DEBUG
            //    alert(tableName + " IS DTABLE");
            //} else {

            //}


            //if (!$.fn.DataTable.isDataTable(tableName)) {
            //    var table = $(tableName).DataTable({
            //        dom: 'Blfrtip',
            //        paging: true,
            //        "pageLength": 10,
            //        initComplete: function () {
            //            SetControlVisibility(tableName);
            //        },
            //        responsive: true,
            //        buttons: [
            //            'selectAll',
            //            'selectNone',
            //            'csv',
            //            'excel',
            //            'pdf'
            //        ],
            //        select: true,
            //        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            //        columnDefs: [
            //            { targets: [0], visible: false }
            //        ]
            //    });
            //}
            //else {

            //}
        });
    }

    //$('#DEBUG-TABS ul.nav li').on('click', function () {
    //    var tabName = $(this).attr('id');
    //    var title = $(this).attr('title');
    //    var folderId = tabName.replace("custom-tabs-two-home-tab-selector-", "");
    //    LoadFolderItems(title, folderId);
    //});

    $('#section-folder-category ul.nav li').on('click', function () {
        var category = $(this).attr('id');
        LoadFolders("", category);
    });

    $('#section-folder-type ul.nav li').on('click', function () {
        var type = $(this).attr('id');
        LoadFolders(type, "");
    });

    function LoadFolders(folderType, category) {
        var link = '@Url.Action("_ListExplorer", "Folder")';
        var formData = new FormData();

        formData.append("folderType", folderType);
        formData.append("folderCategory", category);

        $("#progress_overlay").show();

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-folder-list").html(response);
                $("#progress_overlay").hide();
            },
            error: function (jqXHR) {
                alert("Error loading folder: " + jqXHR.responseText);
                $("#progress_overlay").hide();
            }
        });
    }

    function LoadFolderItems(folderTypeDescription, folderId)  {
        var link = '@Url.Action("_ListFolderItems", "CONTROLLER_NAME")';
        link = link.replace("CONTROLLER_NAME", folderTypeDescription);

        var formData = new FormData();

        formData.append("folderID", folderId);

        $("#progress_overlay").show();

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#custom-tabs-two-tabContent").html(response);
                $("#progress_overlay").hide();
            },
            error: function (jqXHR) {
                alert("Error loading folder contents: " + jqXHR.responseText);
                $("#progress_overlay").hide();
            }
        });
    }

</script>
