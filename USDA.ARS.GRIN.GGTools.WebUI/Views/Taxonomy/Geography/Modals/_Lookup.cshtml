@model USDA.ARS.GRIN.GGTools.Taxonomy.ViewModelLayer.GeographyViewModelBase
<div class="modal fade" id="modal-geography-lookup" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    <i class="fas fa-globe"></i>
                    Map Geography: @Html.Raw(Model.SpeciesName)
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <!--DEBUG-->
                @*<div class="row">
                    <div class="col-md-12">
                        <input type="text" id="txtDEBUGSubContinents" style="background-color:yellow; width:100%;" />
                        <input type="text" id="txtDEBUGCountries" style="background-color:yellow; width:100%;" />
                    </div>
                </div>*@

                <div id="section-continents" class="row">
                    <div class="card-title">Continents</div>
                    <div class="col-md-12">
                        @{Html.RenderAction("_ListContinents", "Geography"); }
                    </div>
                </div>
                <br />
                <div class="row">
                    <!-- SUBCONTINENT -->
                    <div class="col-md-3">
                        <div class="card card-default card-outline">
                            <div class="card-header">
                                <h3 class="card-title">SubContinents</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="section-subcontinents">

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- COUNTRY -->
                    <div class="col-md-3">
                        <div class="card card-default card-outline">
                            <div class="card-header">
                                <h3 class="card-title">Countries</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="section-countries">

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ADMIN -->
                    <div class="col-md-3">
                        <div class="card card-default card-outline">
                            <div class="card-header">
                                <h3 class="card-title">Administrative Units</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">

                                

                                <div id="section-administrative-units">

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- GEO MAP -->
                    <div class="col-md-3">
                        <div class="card card-primary card-outline">
                            <div class="card-header">
                                <h3 class="card-title">Maps</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="section-geography-maps">
                                    @{Html.RenderAction("_SelectList","GeographyMap", new {@speciesId = Model.SpeciesID }); }
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $("#btnLookupGeography").click(function () {
        SearchGeography();
    });

    $(document).on("click", "[id='btnGetSelectedSubContinents']", function () {
        var selectedSubContinents = GetSelectedEntityIDs("data-table-geography-subcontinents");
        //DEBUG
        /*alert("GET SEL" + selectedSubContinents);*/

        //DEBUG
        $("#txtDEBUGSubContinents").val(selectedSubContinents);
        LoadCountries(selectedSubContinents);
    });

    $(document).on("click", "[id='btnGetSelectedCountries']", function () {
        var selectedCountries = GetSelectedEntityStringIDs("data-table-geography-countries");
        //DEBUG
        $("#txtDEBUGCountries").val(selectedCountries);
        //TODO Get admin units
        LoadAdministrativeUnits(selectedCountries);
    });

    function GetSelectedContinents() {
        var selected = [];
        $('#section-select-continents input:checked').each(function () {
            selected.push("'" + $(this).attr('id') + "'");
        });
        LoadSubContinents(selected);
    }

    function LoadSubContinents(continents) {
        var link = '@Url.Action("_ListSubContinents", "Geography")';
        var formData = new FormData();
        formData.append("continents", continents);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-subcontinents").html(response);
            },
            error: function () {
                alert("Error searching geography");
            }
        });
    }

    function LoadCountries(subContinents) {
        var link = '@Url.Action("_ListCountries", "Geography")';
        var formData = new FormData();
        formData.append("subContinents", subContinents);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-countries").html(response);
            },
            error: function () {
                alert("Error searching geography");
            }
        });
    }

    function LoadAdministrativeUnits(countries) {
        var link = '@Url.Action("_ListAdministrativeUnits", "Geography")';
        var formData = new FormData();
        formData.append("countries", countries);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-administrative-units").html(response);
            },
            error: function () {
                alert("Error searching geography");
            }
        });
    }

    function AddGeographyMaps(administrativeUnits, status) {

    }

    // ======================================================================
    // Utilities
    // ======================================================================
    function InitDataTableGeo(tableName) {
        $(document).ready(function () {
            table = $("#" + tableName).DataTable({
                dom: 'Blfrtip',
                paging: false,
                rowId: 'extn',
                stateSave: true,
                "bLengthChange": false,
                scrollY: '300px',
                scrollCollapse: true,
                paging: false,
                responsive: true,
                select: true,
                searching: false,
                buttons: [
                    'selectAll',
                    'selectNone'
                ],
                columnDefs: [
                    { targets: [0], visible: false }
                ]
            });
            table.row(':contains("Basionym")').select()
            //$("#" + tableName + ' tbody').on('click', 'tr', function () {
            //    var selectedSubContinents = GetSelectedEntityIDs(tableName);
            //    //DEBUG
            //    //alert("SELECTED SUBCONTINENTS " + selectedSubContinents);
            //    $("#txtDEBUGSubContinents").val(selectedSubContinents);
            //});
        });
    }

</script>