@model USDA.ARS.GRIN.GGTools.ViewModelLayer.CooperatorViewModel
@{
    ViewBag.Title = Model.PageTitle;
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}

<div class="row">
    <div class="col-md-12">

        <div id="accordion">
            <!-- COOP -->
            <div class="card card-success">
                <div class="card-header">
                    <h4 class="card-title w-100">
                        <a class="d-block w-100 collapsed" data-toggle="collapse" href="#collapseCooperator" aria-expanded="false">
                            Cooperator
                        </a>
                    </h4>
                </div>
                <div id="collapseCooperator" class="collapse" data-parent="#accordion" style="">
                    <div id="section-cooperator" class="card-body">
                        @{Html.RenderAction("_Get", "Cooperator", new { @entityId = Model.Entity.ID }); }
                    </div>
                </div>
            </div>

            <!-- WEB COOP -->
            <div class="card card-success">
                <div class="card-header">
                    <h4 class="card-title w-100">
                        <a class="d-block w-100 collapsed" data-toggle="collapse" href="#collapseWebCooperator" aria-expanded="false">
                            Web Cooperator
                        </a>
                    </h4>
                </div>
                <div id="collapseWebCooperator" class="collapse" data-parent="#accordion" style="">
                    <div id="section-cooperator" class="card-body">
                        @{Html.RenderAction("_Get", "WebCooperator", new { @entityId = Model.Entity.WebCooperatorID }); }
                    </div>
                </div>
            </div>

            <!-- SYS USER-->
            <div class="card card-success">
                <div class="card-header">
                    <h4 class="card-title w-100">
                        <a class="d-block w-100 collapsed" data-toggle="collapse" href="#collapseSysUser" aria-expanded="false">
                            Sys User
                        </a>
                    </h4>
                </div>
                <div id="collapseSysUser" class="collapse" data-parent="#accordion" style="">
                    <div id="section-sys-user" class="card-body">
                        @{Html.RenderAction("_Get", "SysUser", new { @entityId = Model.Entity.SysUserID }); }
                    </div>
                </div>
            </div>

            <!-- WEB USER -->
            <div class="card card-success">
                <div class="card-header">
                    <h4 class="card-title w-100">
                        <a class="d-block w-100" data-toggle="collapse" href="#collapseThree" aria-expanded="false">
                            Web User
                        </a>
                    </h4>
                </div>
                <div id="collapseThree" class="collapse" data-parent="#accordion" style="">
                    <div id="section-web-user" class="card-body">
                        @{Html.RenderAction("_Get", "WebUser", new { @entityId = Model.Entity.WebUserID }); }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        Init();
    });

    function Init() {
        /*SetReadOnly();*/
    }

    $(document).on("click", "[id*='btnSaveCooperator']", function () {
        SaveCooperator();
    });

    $(document).on("click", "[id*='btnSaveWebCooperator']", function () {
        SaveWebCooperator();
    });

    $(document).on("click", "[id*='btnSaveSysUser']", function () {
        SaveSysUser();
    });

    $(document).on("click", "[id*='btnSaveWebUser']", function () {
        SaveWebUser();
    });

    function SaveCooperator() {
        var link = $("#frmEditCooperator").attr("action");
        var formData = new FormData();

        formData.append("Entity.ID", $("#frmEditCooperator #Entity_ID").val());
        formData.append("Entity.StatusCode", $("#frmEditCooperator #Entity_StatusCode").val());
        formData.append("Entity.Salutation", $("#frmEditCooperator #Entity_Salutation").val());
        formData.append("Entity.FirstName", $("#frmEditCooperator #Entity_FirstName").val());
        formData.append("Entity.LastName", $("#frmEditCooperator #Entity_LastName").val());
        formData.append("Entity.JobTitle", $("#frmEditCooperator #Entity_JobTitle").val());
        formData.append("Entity.Organization", $("#frmEditCooperator #Entity_Organization").val());
        formData.append("Entity.OrganizationAbbrev", $("#frmEditCooperator #Entity_OrganizationAbbrev").val());
        formData.append("Entity.EmailAddress", $("#frmEditCooperator #Entity_EmailAddress").val());
        formData.append("Entity.PrimaryPhone", $("#frmEditCooperator #Entity_PrimaryPhone").val());
        formData.append("Entity.CategoryCode", $("#frmEditCooperator #Entity_CategoryCode").val());
        formData.append("Entity.SiteID", $("#frmEditCooperator #Entity_SiteID").val());
        formData.append("Entity.AddressLine1", $("#frmEditCooperator #Entity_AddressLine1").val());
        formData.append("Entity.AddressLine2", $("#frmEditCooperator #Entity_AddressLine2").val());
        formData.append("Entity.AddressLine3", $("#frmEditCooperator #Entity_AddressLine3").val());
        formData.append("Entity.City", $("#frmEditCooperator #Entity_City").val());
        formData.append("Entity.GeographyID", $("#frmEditCooperator #Entity_GeographyID").val());
        formData.append("Entity.PostalIndex", $("#frmEditCooperator #Entity_PostalIndex").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-cooperator").html(response);
            },
            error: function () {
                alert("Error");
            }
        });
    }

    function SaveWebCooperator() {
        var link = $("#frmEditWebCooperator").attr("action");
        // DEBUG
        alert("SAVE WC");
    }

    function SaveSysUser() {
        var link = $("#frmEditSysCooperator").attr("action");
        // DEBUG
        alert("SAVE SU " + link);
    }

    function SaveWebUser() {
        var link = $("#frmEditWebUser").attr("action");
        // DEBUG
        alert("SAVE WU " + link);
    }

    //$('#btnEditGroups').on('click', function () {
    //    $("#modal_sys_group_user_map_lookup").modal("show");
    //});

    //$('#btnSaveSysUser').on('click', function () {
    //    AjaxFormSubmit();
    //});

    //$('#btnSubmitResetPassword').on('click', function () {
    //    AjaxFormSubmit();
    //});

    @*function LoadRecordsOwnedList(cooperatorId) {
        var link = '@Url.Action("RenderRecordsOwnedList","Cooperator")';
        var formData = new FormData();
        var partialViewSectionName = "";

        formData.append("cooperatorId", cooperatorId);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#tab-records-owned").html(response);
            }
        });
    }*@

    function RenderSysUserWidget(sysUserId) {
        var link = '@Url.Action("RenderWidget","SysUser")';
        var formData = new FormData();
        formData.append("sysUserId", sysUserId);
        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-sys-user").html(response);
            }
        });
    }

    function RenderSysGroupWidget(sysUserId) {
        var link = '@Url.Action("RenderSysGroupWidget","SysUser")';
        var formData = new FormData();
        formData.append("sysUserId", sysUserId);
        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-sys-group").html(response);
            }
        });
    }

    function AjaxFormSubmit() {
        var link = $("#frmEditSysUser").attr("action");
        var formData = new FormData();
        formData.append("Entity.CooperatorID", $("#frmEditCooperator #Entity_ID").val());
        formData.append("Entity.SysUserID", $("#frmEditSysUser #Entity_SysUserID").val());
        formData.append("Entity.UserName", $("#frmEditSysUser #Entity_UserName").val());
        formData.append("Entity.Password", $("#frmEditSysUser #Entity_Password").val());
        formData.append("Entity.PasswordConfirm", $("#frmEditSysUser #Entity_PasswordConfirm").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            dataType: 'json',
            contentType: false,
            processData: false,
            data: formData,
            success: function (data) {
                RenderSysUserWidget(data.sysUser.ID);
                RenderSysGroupWidget(data.sysUser.ID);
            },
            error: function (ex) {
                alert("Error");
            }
        });
    }

    function AjaxResetPasswordFormSubmit() {
        var link = $("#frmSysUserResetPassword").attr("action");
        //TODO
    }
</script>


