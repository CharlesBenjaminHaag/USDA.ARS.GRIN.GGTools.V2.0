<div class="modal fade" id="modal-author-lookup" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    <i class="fas fa-search"></i>
                    Author Lookup
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div id="section-search-criteria" class="modal-body">
                <div class="row">
                    <div class="col-md-5">
                        <label>Short Name</label>
                        <div class="input-group">
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    <input type="checkbox" id="cbxIsAcceptedNameSubject">
                                    &nbsp;Exact Match
                                </span>
                            </div>
                            <input type="text" id="txtAuthorLookupShortName" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="txtAuthorLookupFullName" class="form-control" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="margin">
                            <button id="btnReset" class="btn btn-danger">Reset</button>
                            <button id="btnLookupAuthor" class="btn btn-default float-right">Search</button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div id="section-author-lookup-search-results" class="col-md-12">
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button id="btnSaveAuthor" type="button" class="btn btn-info" data-dismiss="modal">Add Selected Author</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $("#btnLookupAuthor").click(function () {
        SearchAuthor();
    });

    $("#btnLookupAuthorityText").click(function () {
        SearchAuthorityText();
    });

    $("#btnOpenAuthorityLookupModal").click(function () {
        $('#modal-authority-lookup').modal('show');
    });

    function SearchAuthor() {
        var link = '@Url.Action("Lookup","Author")';
        var authorLookupShortName = $("#txtAuthorLookupShortName").val();
        var authorLookupFullName = $("#txtAuthorLookupFullName").val();
        var formData = new FormData();

        if ($("#cbxAuthorLookupIsExactMatch").is(":checked")) {
            formData.append("AuthorLookupIsExactMatch", "Y");
        }
        formData.append("AuthorLookupShortName", authorLookupShortName);
        formData.append("AuthorLookupFullName", authorLookupFullName);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-author-lookup-search-results").html(response);
            },
            error: function () {
                alert("Error searching author");
            }
        });
    }

    function SearchAuthorityText() {
        var link = '@Url.Action("LookupTaxa","Author")';
        var tableName = $("#TableName").val();
        var authorityText = $("#txtLookupAuthorityText").val();

        var formData = new FormData();

        formData.append("AuthorityText", authorityText);
        formData.append("TableName", tableName);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-lookup-authority-text-search-results").html(response);
            },
            error: function () {
                alert("Error searching author");
            }
        });
    }

    $("#btnSaveAuthor").click(function () {
        var tableName = $("#TableName").val();
        $('#modal-author-lookup').modal('hide');
        var selectedAuthor = GetSelectedEntityText("data-table-author-lookup");
      
        // TEMP: Should probably keep name consistent. Or use data attribs..
        if (tableName == "taxonomy_species") {
            $("#Entity_SpeciesAuthority").val(selectedAuthor);
        }
        else {
            $("#Entity_Authority").val(selectedAuthor);        }
    });
</script>