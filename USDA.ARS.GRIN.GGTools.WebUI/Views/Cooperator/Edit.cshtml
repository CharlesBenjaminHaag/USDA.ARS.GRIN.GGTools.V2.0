@model USDA.ARS.GRIN.GGTools.ViewModelLayer.CooperatorViewModel
@{
    ViewBag.Title = Model.PageTitle;
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}

<div class="row">
    <div class="col-md-3">
        <div id="card-sys-user">
            @{Html.RenderAction("RenderWidget", "SysUser", new { @sysUserId = Model.Entity.SysUserID }); }
        </div>
        <div id="card-sys-group-user-map">
             
        </div>
    </div>
    <div class="col-md-9">
      
        <div class="card card-primary card-tabs">
            <div id="section-cooperator-tabs" class="card-header p-0 pt-1">
                <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                    <li class="pt-2 px-3"><h3 id="placeholder-cooperator-name" class="card-title">@Model.Entity.FullName [@Model.Entity.ID]</h3></li>
                    <li id="tab-cooperator" class="nav-item">
                        <a class="nav-link active" id="custom-tabs-two-home-tab" data-toggle="pill" href="#tab-content-cooperator" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true">Cooperator</a>
                    </li>
                    <li id="tab-web-cooperator" class="nav-item">
                        <a class="nav-link" id="custom-tabs-two-profile-tab" data-toggle="pill" href="#tab-content-web-cooperator" role="tab" aria-controls="custom-tabs-two-profile" aria-selected="false">Web Cooperator</a>
                    </li>
                    @*<li id="section-web-order-request-tabs-order-request-history" class="nav-item">
                        <a class="nav-link" id="custom-tabs-two-messages-tab" data-toggle="pill" href="#custom-tabs-two-messages" role="tab" aria-controls="custom-tabs-two-messages" aria-selected="false">Order Request History</a>
                    </li>*@
                </ul>
            </div>
            <div class="card-body web-order-request">
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab-content-cooperator" role="tabpanel" aria-labelledby="custom-tabs-two-home-tab">
                        @{Html.RenderAction("_Get", "Cooperator", new { @entityId = Model.Entity.ID }); }
                    </div>
                    <div class="tab-pane fade" id="tab-content-web-cooperator" role="tabpanel" aria-labelledby="custom-tabs-two-home-tab">
                        @{Html.RenderAction("_Get", "WebCooperator", new { @entityId = Model.Entity.WebCooperatorID }); }
                    </div>
                </div>
            </div>
        </div>



    </div>
</div>

<!-- BEGIN CONF EMAIL -->
<div class="modal fade" id="modal-email-preview" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    <i class="fas fa-envelope"></i>
                    Send Confirmation Email
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                @*<div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label>Add Note (Internal User Only)</label>
                    <textarea id="txtEmailRequestorNote" class="form-control note-format" rows="3"></textarea>
                </div>
            </div>
        </div>*@
                <div class="form-group">
                    <label>To</label>
                    <input id="txtEmailRequestorTo" class="form-control" type="text" placeholder="To" value="">
                </div>
                <div class="form-group">
                    <label>From</label>
                    <input id="txtEmailRequestorFrom" class="form-control" type="text" placeholder="To" value="">
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input id="txtEmailRequestorSubject" class="form-control" type="text" placeholder="Subject" value="Request For Additional Information [Web Order #@Model.Entity.ID]">
                    @*<input class="form-control" placeholder="Subject" value="@Model.InformationRequestEmailTemplate.Subject.Replace("[ID_HERE]", Model.ID.ToString())">*@
                </div>
                <br />
                <div class="card">
                    <div class="card-header p-2">
                        <ul class="nav nav-pills">
                            <li class="nav-item"><a class="nav-link active" href="#tab-email-preview" data-toggle="tab">Preview</a></li>
                            <li class="nav-item"><a class="nav-link" href="#tab-email-edit" data-toggle="tab">Edit</a></li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab-email-preview">
                                <p>Dear Person</p>
                                <p>Your GRIN-Global Curator Tool Account has been created:</p>
                                <table>
                                    <tr>
                                        <td>Database</td>
                                        <td>PRODUCTION</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="tab-pane" id="tab-email-edit">
                                
                                    <textarea id="txtEmailRequestorBody" class="form-control" rows="10">
                                    <p>Dear Person</p>
                                    <p>Your GRIN-Global Curator Tool Account has been created:</p>
                                    <table>
                                    <tr>
                                    <td>Database</td>
                                    <td>PRODUCTION</td>
                                            </tr>
                                        </table>        
                                    </textarea>
                                </div>
                            
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="button" id="btnSubmitEmailRequestor" class="btn btn-primary" data-dismiss="modal">Send Email</button>
            </div>
        </div>
    </div>
</div>
<!-- END CONF EMAIL -->

<script type="text/javascript">
    $(document).ready(function () {
        Init();
    });

    function Init() {
        /*SetReadOnly();*/
    }

    $(document).on("click", "[id*='btnSaveCooperator']", function () {
        SaveCooperator();
    });

    $(document).on("click", "[id*='btnSaveWebCooperator']", function () {
        SaveWebCooperator();
    });

    $(document).on("click", "[id*='btnCopyWebCooperator']", function () {
        CopyWebCooperator();
    });

    $(document).on("click", "[id*='btnSaveSysUser']", function () {
        SaveSysUser();
    });

    $(document).on("click", "[id*='btnSaveWebUser']", function () {
        SaveWebUser();
    });

    $(document).on("click", "[id*='btnCopyWebUser']", function () {
        CopyWebUser();
    });

    function SaveCooperator() {
        var link = $("#frmEditCooperator").attr("action");
        var formData = new FormData();

        formData.append("Entity.ID", $("#frmEditCooperator #Entity_ID").val());
        formData.append("Entity.StatusCode", $("#frmEditCooperator #Entity_StatusCode").val());
        formData.append("Entity.Salutation", $("#frmEditCooperator #Entity_Salutation").val());
        formData.append("Entity.FirstName", $("#frmEditCooperator #Entity_FirstName").val());
        formData.append("Entity.LastName", $("#frmEditCooperator #Entity_LastName").val());
        formData.append("Entity.JobTitle", $("#frmEditCooperator #Entity_JobTitle").val());
        formData.append("Entity.Organization", $("#frmEditCooperator #Entity_Organization").val());
        formData.append("Entity.OrganizationAbbrev", $("#frmEditCooperator #Entity_OrganizationAbbrev").val());
        formData.append("Entity.EmailAddress", $("#frmEditCooperator #Entity_EmailAddress").val());
        formData.append("Entity.PrimaryPhone", $("#frmEditCooperator #Entity_PrimaryPhone").val());
        formData.append("Entity.CategoryCode", $("#frmEditCooperator #Entity_CategoryCode").val());
        formData.append("Entity.SiteID", $("#frmEditCooperator #Entity_SiteID").val());
        formData.append("Entity.AddressLine1", $("#frmEditCooperator #Entity_AddressLine1").val());
        formData.append("Entity.AddressLine2", $("#frmEditCooperator #Entity_AddressLine2").val());
        formData.append("Entity.AddressLine3", $("#frmEditCooperator #Entity_AddressLine3").val());
        formData.append("Entity.City", $("#frmEditCooperator #Entity_City").val());
        formData.append("Entity.GeographyID", $("#frmEditCooperator #Entity_GeographyID").val());
        formData.append("Entity.PostalIndex", $("#frmEditCooperator #Entity_PostalIndex").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#card-cooperator").html(response);
            },
            error: function () {
                alert("Error");
            }
        });
    }

    function SaveWebCooperator() {
        var link = $("#frmEditWebCooperator").attr("action");
        // DEBUG
        alert("SAVE WC");
        $("#section-card-web-cooperator").removeClass("card-danger");
        $("#section-card-web-cooperator").addClass("card-default");
    }

    function CopyWebCooperator() {
        var link = '@Url.Action("Copy","WebCooperator")';
        var formData = new FormData();

        formData.append("Entity.ID", $("#frmEditWebCooperator #Entity_ID").val());
        formData.append("CooperatorID", $("#frmEditWebCooperator #CooperatorID").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#card-web-cooperator").html(response);
            },
            error: function () {
                alert("Error");
            }
        });
    }

    function SaveSysUser() {
        var link = $("#frmEditSysUser").attr("action");
        var formData = new FormData();

        formData.append("Entity.CooperatorID", $("#frmEditSysUser #Entity_CooperatorID").val());
        formData.append("Entity.SysUserID", $("#frmEditSysUser #Entity_SysUserID").val());
        formData.append("Entity.SysUserName", $("#frmEditSysUser #Entity_SysUserName").val());
        formData.append("Entity.SysUserPassword", $("#frmEditSysUser #Entity_SysUserPassword").val());
        formData.append("Entity.SysUserPasswordConfirm", $("#frmEditSysUser #Entity_SysUserPasswordConfirm").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#card-sys-user").html(response);
            },
            error: function () {
                alert("Error");
            }
        });
    }

    function SaveWebUser() {
        var link = $("#frmEditWebUser").attr("action");
        // DEBUG
        alert("SAVE WU " + link);
        $("#section-card-web-user").removeClass("card-danger");
        $("#section-card-web-user").addClass("card-default");
    }

    function CopyWebUser() {
        var link = '@Url.Action("Copy","WebUser")';
        var sysUserId = $("#frmEditSysUser #Entity_ID").val();
        var webCooperatorId = $("#frmEditWebCooperator #Entity_ID").val();
        var webUserName = $("#frmEditCooperator #Entity_EmailAddress").val();
        var formData = new FormData();

        //DEBUG
        alert("SU IS " + sysUserId + " AND WC IS " + webCooperatorId + " AND USER NAME IS " + webUserName);

        formData.append("SysUserID", sysUserId);
        formData.append("Entity.WebCooperatorID", webCooperatorId);
       /* formData.append("Entity.WebCooperatorID", webCooperatorId);*/

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#card-web-user").html(response);
            },
            error: function () {
                alert("Error");
            }
        });
    }
    //$('#btnEditGroups').on('click', function () {
    //    $("#modal_sys_group_user_map_lookup").modal("show");
    //});

    //$('#btnSaveSysUser').on('click', function () {
    //    AjaxFormSubmit();
    //});

    //$('#btnSubmitResetPassword').on('click', function () {
    //    AjaxFormSubmit();
    //});

    @*function LoadRecordsOwnedList(cooperatorId) {
        var link = '@Url.Action("RenderRecordsOwnedList","Cooperator")';
        var formData = new FormData();
        var partialViewSectionName = "";

        formData.append("cooperatorId", cooperatorId);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#tab-records-owned").html(response);
            }
        });
    }*@

    function RenderSysUserWidget(sysUserId) {
        var link = '@Url.Action("RenderWidget","SysUser")';
        var formData = new FormData();
        formData.append("sysUserId", sysUserId);
        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-sys-user").html(response);
            }
        });
    }

    function RenderSysGroupWidget(sysUserId) {
        var link = '@Url.Action("RenderSysGroupWidget","SysUser")';
        var formData = new FormData();
        formData.append("sysUserId", sysUserId);
        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-sys-group").html(response);
            }
        });
    }

    function AjaxFormSubmit() {
        var link = $("#frmEditSysUser").attr("action");
        var formData = new FormData();
        formData.append("Entity.CooperatorID", $("#frmEditCooperator #Entity_ID").val());
        formData.append("Entity.SysUserID", $("#frmEditSysUser #Entity_SysUserID").val());
        formData.append("Entity.UserName", $("#frmEditSysUser #Entity_UserName").val());
        formData.append("Entity.Password", $("#frmEditSysUser #Entity_Password").val());
        formData.append("Entity.PasswordConfirm", $("#frmEditSysUser #Entity_PasswordConfirm").val());

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            dataType: 'json',
            contentType: false,
            processData: false,
            data: formData,
            success: function (data) {
                RenderSysUserWidget(data.sysUser.ID);
                RenderSysGroupWidget(data.sysUser.ID);
            },
            error: function (ex) {
                alert("Error");
            }
        });
    }

    function AjaxResetPasswordFormSubmit() {
        var link = $("#frmSysUserResetPassword").attr("action");
        //TODO
    }
</script>


