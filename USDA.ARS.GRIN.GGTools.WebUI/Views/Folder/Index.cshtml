@model USDA.ARS.GRIN.GGTools.ViewModelLayer.FolderViewModel
@{
    ViewBag.Title = Model.PageTitle;
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}
<div id="overlay"></div>

<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Category</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <ul class="nav nav-pills flex-column">

                    <li class="nav-item active">
                        <a href="@Url.Action("Explorer","Folder", new { isFavorite="Y" })" class="nav-link">
                            <i class="fas fa-star text-warning"></i> Favorites
                        </a>
                    </li>

                    <li class="nav-item active">
                        <a href="#" class="nav-link">
                            <i class="fas fa-folder"></i> All

                        </a>
                    </li>


                    @*<li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="fas fa-filter"></i> Junk
                            <span class="badge bg-warning float-right">65</span>
                        </a>
                    </li>*@
                </ul>
            </div>

        </div>
    </div>
    <div class="col-md-9">

        <div class="card card-primary card-tabs">
            <div id="DEBUG-TABS" class="card-header p-0 pt-1">
                <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                    <li id="DEFAULT" class="pt-2 px-3"><h3 class="card-title">My Folders</h3></li>
                    @{
                        int i = 0;
                        string tabSelectorCssClass = String.Empty;
                    }
                    @foreach (var result in Model.DataCollection)
                    {
                        if (i == 0)
                        {
                            tabSelectorCssClass = "nav-link active";
                        }
                        else
                        {
                            tabSelectorCssClass = "nav-link";
                        }

                        <li id="custom-tabs-two-home-tab-selector-@result.ID"
                            title="@result.FolderTypeDescription.Replace(" ","")"
                            class="nav-item">
                            <a class="@tabSelectorCssClass" data-toggle="pill" href="#custom-tabs-two-home-@result.ID" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true">
                                @if (result.IsShared == "Y")
                                {
                                    <i class="fa fa-users"></i>
                                }
                                @*@if (result.IsFavorite == true)
                                {
                                    <i class="fas fa-star text-warning"></i>
                                }*@

                                @result.FolderName
                            </a>
                        </li>
                        i++;
                    }
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="custom-tabs-two-tabContent">

                </div>
            </div>
            <div id="progress_overlay" class="overlay">
                <i class="fas fa-2x fa-sync-alt fa-spin"></i>
            </div>
        </div>

    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        Init();
    });

    function Init() {
        // Note that we must load the *second* sequential <li> in the tabbed folder list: first
        // is a static display item.
        var tabName = $("#DEBUG-TABS ul.nav li:nth-child(2)").attr('id');
        var title = $("#DEBUG-TABS ul.nav li:nth-child(2)").attr('title');
        var folderId = tabName.replace("custom-tabs-two-home-tab-selector-", "");
        ListFolderItems(title, folderId);
    }

    function InitDataTablesByClass(className) {
        $(document).ready(function () {
            var table = $(className).DataTable({
                dom: 'Blfrtip',
                paging: true,
                "pageLength": 10,
                initComplete: function () {
                    SetControlVisibility(tableName);
                },
                responsive: true,
                buttons: [
                    'selectAll',
                    'selectNone',
                    'csv',
                    'excel',
                    'pdf',
                    {
                        text: '+ Add',
                        action: function (e, dt, node, config) {
                            AddRecord();
                        }
                    }
                ],
                select: true,
                lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                columnDefs: [
                    { targets: [0], visible: false }
                ]
            });

            //var table = $(tableName).DataTable(); // Valid initialized DataTable
            //if (table instanceof $.fn.dataTable.Api) {
            //    //DEBUG
            //    alert(tableName + " IS DTABLE");
            //} else {

            //}


            //if (!$.fn.DataTable.isDataTable(tableName)) {
            //    var table = $(tableName).DataTable({
            //        dom: 'Blfrtip',
            //        paging: true,
            //        "pageLength": 10,
            //        initComplete: function () {
            //            SetControlVisibility(tableName);
            //        },
            //        responsive: true,
            //        buttons: [
            //            'selectAll',
            //            'selectNone',
            //            'csv',
            //            'excel',
            //            'pdf'
            //        ],
            //        select: true,
            //        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            //        columnDefs: [
            //            { targets: [0], visible: false }
            //        ]
            //    });
            //}
            //else {

            //}
        });
    }

    $('#DEBUG-TABS ul.nav li').on('click', function () {
        var tabName = $(this).attr('id');
        var title = $(this).attr('title');
        var folderId = tabName.replace("custom-tabs-two-home-tab-selector-","");
        ListFolderItems(title, folderId);
    });

    function ListFolderItems(folderTypeDescription, folderId)  {
        var link = '@Url.Action("_ListFolderItems", "CONTROLLER_NAME")';
        link = link.replace("CONTROLLER_NAME", folderTypeDescription);
        var formData = new FormData();

        formData.append("folderID", folderId);

        $("#progress_overlay").show();

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#custom-tabs-two-tabContent").html(response);
                $("#progress_overlay").hide();
            },
            error: function (jqXHR) {
                alert("Error loading folder contents: " + jqXHR.responseText);
                $("#progress_overlay").hide();
            }
        });
    }

</script>
