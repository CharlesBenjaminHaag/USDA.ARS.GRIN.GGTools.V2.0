@model USDA.ARS.GRIN.GGTools.ViewModelLayer.SysDynamicQueryViewModel
@{
    ViewBag.Title = "Dynamic Query";
    Layout = "~/Views/Shared/_LayoutAdminLTE3.cshtml";
}
@Html.HiddenFor(x => x.TableName)
@Html.HiddenFor(x => x.RowsAffected)




<div class="row">
    <div class="col-md-2">


        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Tables</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>

            </div>

            <div class="card-body p-0">
                @foreach (var sysTable in Model.DataCollectionSysTables)
                {
                    string controlId = "collapse" + sysTable.ID.ToString();

                    <div id="accordion">
                        <div class="card card-success m-0">
                            <div class="card-header">
                                <h4 class="card-title w-100">
                                    <a id="@sysTable.SysTableName" class="d-block w-100 collapsed table-selector" data-toggle="collapse" href="#@controlId" aria-expanded="false">
                                        @sysTable.SysTableTitle
                                    </a>
                                </h4>
                            </div>
                            <div id="@controlId" class="collapse" data-parent="#accordion" style="">
                                <div class="card-body p-0">
                                    <table class="table table-hover table-striped">
                                        <tbody>
                                            @foreach (var sysTableField in sysTable.SysTableFields)
                                            {
                                                string sysTableFieldControlId = "check" + sysTableField.ID.ToString();
                                                <tr>
                                                    <td>
                                                        <div class="icheck-primary">
                                                            <input type="checkbox" value="" id="@sysTableFieldControlId" class="field_selector">
                                                            <label for="@sysTableFieldControlId">@sysTableField.FieldTitle</label>
                                                        </div>
                                                    </td>

                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                }
            </div>

        </div>





       

    </div>
    <div class="col-md-10">



        @Html.Partial("~/Views/SysDynamicQuery/_Detail.cshtml")
        @Html.Partial("~/Views/SysDynamicQuery/_SearchResultsList.cshtml")
    </div>
</div>



@{Html.RenderAction("RenderEditModal", "SysDynamicQuery");}

@if (Model.RowsAffected > 0)
{
    Html.RenderAction("RenderEditModal", "AppUserItemFolder", new { @sysTableName = Model.TableName });
}

<script type="text/javascript">
    $('.table-selector').on('click', function () {
        var data = $(this).attr('id');
        var sql = "SELECT * FROM TABLE_NAME";
        sql = sql.replace("TABLE_NAME", data);
        $("#txtSQL").val(sql);
    });

    $('.field-selector').on('click', function () {
        var data = $(this).attr('id');
        alert("DEBUG FIELD IS " + data);
    });
</script>